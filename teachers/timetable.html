<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Timetable Generator - Malawi Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #27ae60 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.8em;
            background: linear-gradient(135deg, #2c3e50, #27ae60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .setup-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #27ae60;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .setup-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.2);
        }

        button {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .add-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .remove-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            padding: 6px 12px;
            font-size: 12px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            font-size: 16px;
            padding: 15px 30px;
        }

        .pdf-btn {
            background: linear-gradient(135deg, #e67e22, #d35400);
            font-size: 16px;
            padding: 15px 30px;
        }

        .dynamic-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .list-item {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #ecf0f1;
            font-size: 13px;
        }

        .timetable-container {
            margin-top: 30px;
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .timetable-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            border-radius: 10px;
        }

        .timetable {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
            font-size: 12px;
        }

        .timetable th, .timetable td {
            border: 1px solid #bdc3c7;
            padding: 8px;
            text-align: center;
            position: relative;
            min-height: 40px;
        }

        .timetable th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: 600;
            font-size: 11px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .timetable th.day-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            font-size: 12px;
            font-weight: 700;
        }

        .timetable td {
            background: #f8f9fa;
            min-height: 50px;
            vertical-align: middle;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timetable td:hover {
            background: #e8f6f3;
            transform: scale(1.02);
        }

        .timetable td.filled {
            font-weight: 600;
            color: white;
            font-size: 11px;
        }

        .timetable td.break-time {
            background: linear-gradient(135deg, #f39c12, #e67e22) !important;
            color: white;
            font-weight: 700;
        }

        .timetable td.lunch-time {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
            color: white;
            font-weight: 700;
        }

        .subject-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .subject-color {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            padding: 6px 12px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            border: 1px solid #ecf0f1;
        }

        .color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #e74c3c;
        }

        .alert {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            font-size: 14px;
        }

        .alert.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .quick-setup {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .quick-setup button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            margin: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #27ae60;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media print {
            body { 
                background: white; 
                padding: 0; 
            }
            .container { 
                box-shadow: none; 
                background: white;
                max-width: none;
            }
            .setup-section, .controls { 
                display: none; 
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .timetable {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì School Timetable Generator</h1>
        
        <div class="quick-setup">
            <h3>Quick Setup for Malawi Schools</h3>
            <p>Click to load common configurations:</p>
            <button onclick="loadMalawiSecondary()">Malawi Secondary School</button>
            <button onclick="loadMalawiPrimary()">Malawi Primary School</button>
            <button onclick="loadCustom()">Start from Scratch</button>
        </div>

        <div class="setup-section">
            <h2>üè´ School Information</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="schoolName">School Name</label>
                    <input type="text" id="schoolName" value="MILLENNIUM PRIVATE SECONDARY SCHOOL" placeholder="Enter school name">
                </div>
                <div class="form-group">
                    <label for="academicYear">Academic Year</label>
                    <input type="text" id="academicYear" value="2024-2025" placeholder="e.g., 2024-2025">
                </div>
                <div class="form-group">
                    <label for="term">Term/Semester</label>
                    <select id="term">
                        <option value="Term 1">Term 1</option>
                        <option value="Term 2">Term 2</option>
                        <option value="Term 3">Term 3</option>
                        <option value="Semester 1">Semester 1</option>
                        <option value="Semester 2">Semester 2</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="setup-section">
            <h2>üìö Classes/Forms Setup</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="newClass">Add Class/Form</label>
                    <input type="text" id="newClass" placeholder="e.g., Form 1A, Class 3, etc.">
                    <button class="add-btn" onclick="addClass()">Add Class</button>
                </div>
            </div>
            <div class="dynamic-list" id="classesList"></div>
        </div>

        <div class="setup-section">
            <h2>üìñ Subjects Setup</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="newSubject">Add Subject</label>
                    <input type="text" id="newSubject" placeholder="e.g., MATH, ENG, CHICH">
                    <button class="add-btn" onclick="addSubject()">Add Subject</button>
                </div>
            </div>
            <div class="dynamic-list" id="subjectsList"></div>
        </div>

        <div class="setup-section">
            <h2>‚è∞ Time Slots Setup</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="startTime">Start Time</label>
                    <input type="time" id="startTime" value="07:30">
                </div>
                <div class="form-group">
                    <label for="endTime">End Time</label>
                    <input type="time" id="endTime" value="14:50">
                </div>
                <div class="form-group">
                    <label for="periodDuration">Period Duration (minutes)</label>
                    <input type="number" id="periodDuration" value="40" min="30" max="90">
                </div>
                <div class="form-group">
                    <label for="breakStart">Break Start</label>
                    <input type="time" id="breakStart" value="10:10">
                </div>
                <div class="form-group">
                    <label for="breakEnd">Break End</label>
                    <input type="time" id="breakEnd" value="10:30">
                </div>
                <div class="form-group">
                    <label for="lunchStart">Lunch Start</label>
                    <input type="time" id="lunchStart" value="12:30">
                </div>
                <div class="form-group">
                    <label for="lunchEnd">Lunch End</label>
                    <input type="time" id="lunchEnd" value="13:30">
                </div>
            </div>
            <button onclick="generateTimeSlots()">Generate Time Slots</button>
            <div class="dynamic-list" id="timeSlotsList"></div>
        </div>

        <div class="controls">
            <button class="generate-btn" onclick="generateTimetable()">üéØ Generate Timetable</button>
            <button class="pdf-btn" onclick="exportToPDF()">üìÑ Export to PDF</button>
            <button onclick="clearTimetable()">üóëÔ∏è Clear All</button>
            <button onclick="saveTimetable()">üíæ Save</button>
            <button onclick="loadTimetable()">üìÇ Load</button>
        </div>

        <div class="stats" id="statsContainer" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalClasses">0</div>
                <div class="stat-label">Classes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalSubjects">0</div>
                <div class="stat-label">Subjects</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalPeriods">0</div>
                <div class="stat-label">Periods/Day</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="filledSlots">0</div>
                <div class="stat-label">Filled Slots</div>
            </div>
        </div>

        <div class="alert" id="alertBox"></div>

        <div class="timetable-container" id="timetableContainer">
            <div class="timetable-header">
                <h2 id="timetableTitle">School Timetable</h2>
                <p>Click on any cell to assign subjects</p>
            </div>
            <div class="subject-colors" id="subjectColors"></div>
            <div style="overflow-x: auto;">
                <table class="timetable" id="timetableGrid"></table>
            </div>
        </div>
    </div>

    <!-- Modal for cell editing -->
    <div id="cellModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Assign Subject</h3>
            <div class="form-group">
                <label for="modalSubject">Select Subject:</label>
                <select id="modalSubject"></select>
            </div>
            <div class="form-group">
                <label for="modalTeacher">Teacher (Optional):</label>
                <input type="text" id="modalTeacher" placeholder="Enter teacher name">
            </div>
            <div class="form-group">
                <label for="modalRoom">Room (Optional):</label>
                <input type="text" id="modalRoom" placeholder="Enter room number">
            </div>
            <button onclick="assignSubject()">Assign</button>
            <button onclick="clearCell()" style="background: #e74c3c;">Clear</button>
        </div>
    </div>

    <script>
        // Global variables
        let classes = [];
        let subjects = [];
        let timeSlots = [];
        let timetableData = {};
        let currentCell = null;
        let subjectColors = {};

        // Initialize with Malawi secondary school defaults
        window.addEventListener('DOMContentLoaded', function() {
            loadMalawiSecondary();
            setupModalEvents();
        });

        function setupModalEvents() {
            const modal = document.getElementById('cellModal');
            const span = document.getElementsByClassName('close')[0];
            
            span.onclick = function() {
                modal.style.display = 'none';
            }
            
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        function loadMalawiSecondary() {
            // Default classes for Malawi secondary
            classes = ['Form 1', 'Form 2', 'Form 3', 'Form 4'];
            subjects = ['MATH', 'ENG', 'CHICH', 'BIO', 'PHY', 'CHEM', 'HIS', 'GEO', 'AGRI', 'SOC', 'L/S'];
            
            updateClassesList();
            updateSubjectsList();
            generateTimeSlots();
            generateSubjectColors();
            showAlert('Malawi Secondary School configuration loaded!', 'success');
        }

        function loadMalawiPrimary() {
            classes = ['Standard 1', 'Standard 2', 'Standard 3', 'Standard 4', 'Standard 5', 'Standard 6', 'Standard 7', 'Standard 8'];
            subjects = ['MATH', 'ENG', 'CHICHEWA', 'SCIENCE', 'SOCIAL STUDIES', 'LIFE SKILLS', 'CREATIVE ARTS', 'PE'];
            
            // Adjust times for primary
            document.getElementById('startTime').value = '07:30';
            document.getElementById('endTime').value = '12:30';
            document.getElementById('lunchStart').value = '10:30';
            document.getElementById('lunchEnd').value = '11:00';
            
            updateClassesList();
            updateSubjectsList();
            generateTimeSlots();
            generateSubjectColors();
            showAlert('Malawi Primary School configuration loaded!', 'success');
        }

        function loadCustom() {
            classes = [];
            subjects = [];
            timeSlots = [];
            updateClassesList();
            updateSubjectsList();
            document.getElementById('timeSlotsList').innerHTML = '';
            showAlert('Custom configuration ready. Add your classes and subjects.', 'success');
        }

        function addClass() {
            const newClass = document.getElementById('newClass').value.trim();
            if (newClass && !classes.includes(newClass)) {
                classes.push(newClass);
                updateClassesList();
                document.getElementById('newClass').value = '';
                updateStats();
            }
        }

        function addSubject() {
            const newSubject = document.getElementById('newSubject').value.trim().toUpperCase();
            if (newSubject && !subjects.includes(newSubject)) {
                subjects.push(newSubject);
                updateSubjectsList();
                generateSubjectColors();
                document.getElementById('newSubject').value = '';
                updateStats();
            }
        }

        function removeClass(className) {
            classes = classes.filter(c => c !== className);
            updateClassesList();
            updateStats();
        }

        function removeSubject(subject) {
            subjects = subjects.filter(s => s !== subject);
            updateSubjectsList();
            generateSubjectColors();
            updateStats();
        }

        function updateClassesList() {
            const container = document.getElementById('classesList');
            container.innerHTML = '';
            classes.forEach(className => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <span>${className}</span>
                    <button class="remove-btn" onclick="removeClass('${className}')">√ó</button>
                `;
                container.appendChild(item);
            });
        }

        function updateSubjectsList() {
            const container = document.getElementById('subjectsList');
            container.innerHTML = '';
            subjects.forEach(subject => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <span>${subject}</span>
                    <button class="remove-btn" onclick="removeSubject('${subject}')">√ó</button>
                `;
                container.appendChild(item);
            });
        }

        function generateTimeSlots() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const duration = parseInt(document.getElementById('periodDuration').value);
            const breakStart = document.getElementById('breakStart').value;
            const breakEnd = document.getElementById('breakEnd').value;
            const lunchStart = document.getElementById('lunchStart').value;
            const lunchEnd = document.getElementById('lunchEnd').value;

            timeSlots = [];
            let current = new Date(`2024-01-01 ${startTime}`);
            const end = new Date(`2024-01-01 ${endTime}`);
            const breakStartTime = new Date(`2024-01-01 ${breakStart}`);
            const breakEndTime = new Date(`2024-01-01 ${breakEnd}`);
            const lunchStartTime = new Date(`2024-01-01 ${lunchStart}`);
            const lunchEndTime = new Date(`2024-01-01 ${lunchEnd}`);

            while (current < end) {
                const slotEnd = new Date(current.getTime() + duration * 60000);
                
                // Check if this is break time
                if (current.getTime() >= breakStartTime.getTime() && current.getTime() < breakEndTime.getTime()) {
                    timeSlots.push({
                        start: formatTime(current),
                        end: formatTime(breakEndTime),
                        label: 'BREAK',
                        type: 'break'
                    });
                    current = new Date(breakEndTime);
                    continue;
                }
                
                // Check if this is lunch time
                if (current.getTime() >= lunchStartTime.getTime() && current.getTime() < lunchEndTime.getTime()) {
                    timeSlots.push({
                        start: formatTime(current),
                        end: formatTime(lunchEndTime),
                        label: 'LUNCH',
                        type: 'lunch'
                    });
                    current = new Date(lunchEndTime);
                    continue;
                }

                if (slotEnd <= end) {
                    timeSlots.push({
                        start: formatTime(current),
                        end: formatTime(slotEnd),
                        label: `${formatTime(current)} - ${formatTime(slotEnd)}`,
                        type: 'period'
                    });
                }
                current = slotEnd;
            }

            updateTimeSlotsDisplay();
            updateStats();
        }

        function formatTime(date) {
            return date.toTimeString().substr(0, 5);
        }

        function updateTimeSlotsDisplay() {
            const container = document.getElementById('timeSlotsList');
            container.innerHTML = '';
            timeSlots.forEach((slot, index) => {
                const item = document.createElement('div');
                item.className = `list-item ${slot.type === 'break' ? 'break-time' : slot.type === 'lunch' ? 'lunch-time' : ''}`;
                item.innerHTML = `<span>${slot.label}</span>`;
                container.appendChild(item);
            });
        }

        function generateSubjectColors() {
            const colors = [
                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6',
                '#1abc9c', '#34495e', '#e67e22', '#95a5a6', '#d35400',
                '#c0392b', '#8e44ad', '#2c3e50', '#16a085', '#27ae60'
            ];

            subjectColors = {};
            subjects.forEach((subject, index) => {
                subjectColors[subject] = colors[index % colors.length];
            });

            updateSubjectColorsDisplay();
        }

        function updateSubjectColorsDisplay() {
            const container = document.getElementById('subjectColors');
            container.innerHTML = '';
            subjects.forEach(subject => {
                const item = document.createElement('div');
                item.className = 'subject-color';
                item.innerHTML = `
                    <div class="color-box" style="background-color: ${subjectColors[subject]}"></div>
                    <span>${subject}</span>
                `;
                container.appendChild(item);
            });
        }

        function generateTimetable() {
            if (classes.length === 0 || subjects.length === 0 || timeSlots.length === 0) {
                showAlert('Please add classes, subjects, and generate time slots first.', 'error');
                return;
            }

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const table = document.getElementById('timetableGrid');
            const schoolName = document.getElementById('schoolName').value || 'School Timetable';
            
            document.getElementById('timetableTitle').innerHTML = `
                <h2>TIMETABLE FOR ${schoolName.toUpperCase()}</h2>
                <p>${document.getElementById('academicYear').value} - ${document.getElementById('term').value}</p>
            `;

            // Create table header
            let headerHTML = '<tr><th>DAY</th><th>CLASS</th>';
            timeSlots.forEach(slot => {
                headerHTML += `<th>${slot.label}</th>`;
            });
            headerHTML += '</tr>';

            // Create table body
            let bodyHTML = '';
            days.forEach(day => {
                classes.forEach((className, classIndex) => {
                    let rowHTML = `<tr>`;
                    
                    // Add day column for first class of each day
                    if (classIndex === 0) {
                        rowHTML += `<td class="day-header" rowspan="${classes.length}">${day}</td>`;
                    }
                    
                    // Add class name
                    rowHTML += `<td class="day-header">${className}</td>`;
                    
                    // Add time slots
                    timeSlots.forEach((slot, slotIndex) => {
                        const cellId = `${day}-${className}-${slotIndex}`;
                        let cellClass = '';
                        let cellContent = '';
                        
                        if (slot.type === 'break') {
                            cellClass = 'break-time';
                            cellContent = 'BREAK';
                        } else if (slot.type === 'lunch') {
                            cellClass = 'lunch-time';
                            cellContent = 'LUNCH';
                        } else {
                            cellClass = 'period-cell';
                            cellContent = '';
                        }
                        
                        rowHTML += `<td class="${cellClass}" data-cell="${cellId}" onclick="openCellModal('${cellId}')">${cellContent}</td>`;
                    });
                    
                    rowHTML += '</tr>';
                    bodyHTML += rowHTML;
                });
            });

            table.innerHTML = headerHTML + bodyHTML;
            
            // Show timetable container and stats
            document.getElementById('timetableContainer').style.display = 'block';
            document.getElementById('statsContainer').style.display = 'block';
            updateStats();
            showAlert('Timetable generated successfully! Click on cells to assign subjects.', 'success');
        }

        function openCellModal(cellId) {
            const cell = document.querySelector(`[data-cell="${cellId}"]`);
            
            // Don't allow editing break/lunch cells
            if (cell.classList.contains('break-time') || cell.classList.contains('lunch-time')) {
                return;
            }
            
            currentCell = cellId;
            const modal = document.getElementById('cellModal');
            const subjectSelect = document.getElementById('modalSubject');
            
            // Populate subjects dropdown
            subjectSelect.innerHTML = '<option value="">Select a subject</option>';
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
            });
            
            // Pre-fill with existing data if available
            if (timetableData[cellId]) {
                document.getElementById('modalSubject').value = timetableData[cellId].subject;
                document.getElementById('modalTeacher').value = timetableData[cellId].teacher || '';
                document.getElementById('modalRoom').value = timetableData[cellId].room || '';
            } else {
                document.getElementById('modalSubject').value = '';
                document.getElementById('modalTeacher').value = '';
                document.getElementById('modalRoom').value = '';
            }
            
            modal.style.display = 'block';
        }

        function assignSubject() {
            const subject = document.getElementById('modalSubject').value;
            const teacher = document.getElementById('modalTeacher').value;
            const room = document.getElementById('modalRoom').value;
            
            if (!subject) {
                showAlert('Please select a subject.', 'error');
                return;
            }
            
            // Save data
            timetableData[currentCell] = {
                subject: subject,
                teacher: teacher,
                room: room
            };
            
            // Update cell appearance
            const cell = document.querySelector(`[data-cell="${currentCell}"]`);
            cell.innerHTML = `
                <div><strong>${subject}</strong></div>
                ${teacher ? `<div style="font-size: 10px;">${teacher}</div>` : ''}
                ${room ? `<div style="font-size: 10px;">Room: ${room}</div>` : ''}
            `;
            cell.style.backgroundColor = subjectColors[subject];
            cell.classList.add('filled');
            
            // Close modal
            document.getElementById('cellModal').style.display = 'none';
            updateStats();
        }

        function clearCell() {
            if (timetableData[currentCell]) {
                delete timetableData[currentCell];
            }
            
            const cell = document.querySelector(`[data-cell="${currentCell}"]`);
            cell.innerHTML = '';
            cell.style.backgroundColor = '';
            cell.classList.remove('filled');
            
            document.getElementById('cellModal').style.display = 'none';
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalClasses').textContent = classes.length;
            document.getElementById('totalSubjects').textContent = subjects.length;
            document.getElementById('totalPeriods').textContent = timeSlots.filter(slot => slot.type === 'period').length;
            document.getElementById('filledSlots').textContent = Object.keys(timetableData).length;
        }

        function showAlert(message, type = 'success') {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = `alert ${type === 'error' ? 'error' : ''}`;
            alertBox.style.display = 'block';
            
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        function clearTimetable() {
            if (confirm('Are you sure you want to clear all timetable data?')) {
                timetableData = {};
                const cells = document.querySelectorAll('.period-cell');
                cells.forEach(cell => {
                    if (!cell.classList.contains('break-time') && !cell.classList.contains('lunch-time')) {
                        cell.innerHTML = '';
                        cell.style.backgroundColor = '';
                        cell.classList.remove('filled');
                    }
                });
                updateStats();
                showAlert('Timetable cleared successfully.', 'success');
            }
        }

        function saveTimetable() {
            const data = {
                schoolName: document.getElementById('schoolName').value,
                academicYear: document.getElementById('academicYear').value,
                term: document.getElementById('term').value,
                classes: classes,
                subjects: subjects,
                timeSlots: timeSlots,
                timetableData: timetableData,
                subjectColors: subjectColors
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `timetable_${data.schoolName.replace(/\s+/g, '_')}_${Date.now()}.json`;
            link.click();
            
            showAlert('Timetable saved successfully!', 'success');
        }

        function loadTimetable() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Load all data
                            document.getElementById('schoolName').value = data.schoolName || '';
                            document.getElementById('academicYear').value = data.academicYear || '';
                            document.getElementById('term').value = data.term || '';
                            
                            classes = data.classes || [];
                            subjects = data.subjects || [];
                            timeSlots = data.timeSlots || [];
                            timetableData = data.timetableData || {};
                            subjectColors = data.subjectColors || {};
                            
                            updateClassesList();
                            updateSubjectsList();
                            updateTimeSlotsDisplay();
                            updateSubjectColorsDisplay();
                            generateTimetable();
                            
                            // Restore timetable data
                            Object.keys(timetableData).forEach(cellId => {
                                const cell = document.querySelector(`[data-cell="${cellId}"]`);
                                if (cell) {
                                    const data = timetableData[cellId];
                                    cell.innerHTML = `
                                        <div><strong>${data.subject}</strong></div>
                                        ${data.teacher ? `<div style="font-size: 10px;">${data.teacher}</div>` : ''}
                                        ${data.room ? `<div style="font-size: 10px;">Room: ${data.room}</div>` : ''}
                                    `;
                                    cell.style.backgroundColor = subjectColors[data.subject];
                                    cell.classList.add('filled');
                                }
                            });
                            
                            showAlert('Timetable loaded successfully!', 'success');
                        } catch (error) {
                            showAlert('Error loading timetable file.', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function exportToPDF() {
            showAlert('PDF export functionality would require a PDF library. For now, use your browser\'s print function (Ctrl+P) to save as PDF.', 'success');
            window.print();
        }

        // Allow Enter key to add classes and subjects
        document.getElementById('newClass').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addClass();
            }
        });

        document.getElementById('newSubject').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addSubject();
            }
        });
    </script>
</body>
</html>